# Introduction

The demo is intended to be used by institutional clients using Client Portal API with OAuth for in-house use only. It contains only a subset of endpoints via the API, for an exhaustive list of available endpoints, check out the [endpoints](https://interactivebrokers.github.io/cpwebapi/endpoints) page of the Client Portal API docs.

## Using the test environment

---

IBKR recommends testing your integration against the test environment before moving to the live, production environment. To get started with the test environment, follow these steps:

1. Use the web demo provided by IBKR and authenticate the request token with your paper account credentials.
2. Open the `test-config.json` configuration file included with the demo.
3. Copy the access token and access token secret generated by the web demo and paste them into the corresponding fields in the config file.

**Note:** If you generate a new access token secret, the previous one will stop working, and you will receive a `(401) LST Failed` exception when attempting to request the live session token with it. You will need to update the access token secret in your project configuration with the new one.

## Switching over to live environment

---

To switch from the test environment to a live one for the Client Portal API, follow these steps:

1. Log in to the [self-service portal](https://ndcdyn.interactivebrokers.com/oauth/?action=OAUTH&RL=1&ip2loc=US) with your live username and password.
2. Enable OAuth access by toggling the "Enable OAuth Access" switch.
3. Create a unique 9-character alphanumeric consumer key and save it.
4. Generate and upload the public signing key, public encryption key, and Diffie-Hellman parameters by following the steps in the portal, or run the `generate.sh` script found in the `keys` directory.
5. Generate the access token and access token secret by pressing the "Generate Token" button.
6. Update the config.json file with your integration details.

**TIP:** To get the hexadecimal representation of the Diffie-Hellman prime, navigate to the directory where you are storing your keys and run the following in your terminal: `openssl asn1parse -in dhparam.pem`.

**Note:** It may take up to 24 hours for the consumer key to update on the backend.

**Note:** If you generate a new access token secret, the previous one will stop working, and you will receive a `(401) LST Failed` exception when attempting to request the live session token with it. You will need to update the access token secret in your project configuration with the new one.

## Running the demo

---

Once you have prepared the necessary configuration files (see sections above), you can proceed to run the demo:

0. **NOT REQUIRED, BUT HIGHLY RECOMMENDED** Create and activate a new virtual environment by running `python -m venv venv`, followed by `venv/scripts/activate`.
1. Install project dependencies by running `pip install -r requirements.txt`.
2. Update the `config.json`, or `config-test.json` for test environment, configuration files with data generated in the quickstart section.
3. Update the `CONFIG` file field `path-to-your-app-config` in the `demo.py` file with the path to your config file.
4. Run the demo.

## The config file

---

In order to run the demo you'll need to point to a configuration file. This configuration file contains the path to your private encryption and signature keys, the consumer key, the Diffie-Helmann prime in hex, and the access token and access token secret.

```json
{
    "realm": "limited_poa",
    "encryption_key_fp": "path-to-private-encryption-key",
    "signature_key_fp": "path-to-private-signature-key",
    "consumer_key": "your-consumer-key",
    "dh_prime": "generated-dh-prime-in-hex",
    "access_token": "your-access-token-from-self-service-portal",
    "access_token_secret": "your-access-token-secret-from-self-service-portal"
}
```
